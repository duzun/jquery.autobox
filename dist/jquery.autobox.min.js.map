{"version":3,"file":"jquery.autobox.min.js","sources":["src/jquery.autobox.js"],"sourcesContent":["/**\n * Autogrow Textareas\n * jQuery.autobox\n *\n * https://github.com/duzun/jquery.autobox\n *\n * Copyright (c) 2021 Dumitru Uzun\n *\n *  @license The MIT license.\n *  @version 3.1.0\n *  @author DUzun.Me\n */\n\n/**\n *\n * Usage:\n *\n * $().\n *    autobox(options)        - Adjust Height/Width of all TEXTAREAs in this and it's descendants\n *    autoboxOn(sel, options) - Bind Auto Height/Width Adjustment events to matched element, listening on sel elements\n *    autoboxBind(options)    - Bind Auto Height/Width Adjustment events to all TEXTAREAs in this and it's descendants\n *\n * $.autobox(elements, options) - same as $(elements).autobox(options)\n *\n * Options:\n *  permanent: bool - if false, the textarea would restore its size on blur\n *  resize: \"vertical\" | \"horizontal\" | <empty> - resize mode, leave empty for autodetection\n *  speed: number - restore height animation speed (default 0 - no animation)\n *  delay: number - delay before restoring textarea height on blur (default 250 milliseconds)\n *\n */\n\n/*jshint\n    esversion: 9,\n    browser: true\n*/\n\nconst TEXTAREA = 'TEXTAREA';\nconst AUTOBOXED_CLASS = 'autoboxed';\nconst NAMESPACE = '.dynSiz';\n\nconst _events = [\n        'autobox'\n      , 'keypress'\n      , 'keyup'\n      , 'click'\n      , 'change'\n      , 'focusin'\n      , 'cut'\n      , 'paste'\n    ]\n;\n\n// Constants for internal use\nconst RESIZE_VERTICAL_FLAG   = 1;\nconst RESIZE_HORIZONTAL_FLAG = 2;\n\nconst ROWS_POS       = 0;\nconst COLS_POS       = 1;\nconst HEIGHT_POS     = 2;\nconst WIDTH_POS      = 3;\nconst OVERFLOW_Y_POS = 4;\nconst OVERFLOW_X_POS = 5;\nconst RESIZE_POS     = 6;\n\nexport default function initJQAutobox($) {\n    var cchChkElement;\n    var cchChkWidth;\n    var cchChkHeight;\n\n    function taMH(h,i) {\n        if ( !h || ( (i=parseInt(h, 10)) && i < 18 ) ) {\n            h = '18px';\n        }\n        return h;\n    }\n\n    function findTEXTAREA(ctx) {\n        return ctx.filter(TEXTAREA).add(ctx.find(TEXTAREA));\n    }\n\n    function chkSize(s, save) {\n        var t = $(s)\n        ,   w = t.outerWidth()\n        ,   h = t.outerHeight()\n        ;\n        s = t.get(0);\n        if ( save ) {\n            if ( cchChkElement && cchChkElement !== s ) {\n                chkSize(cchChkElement);\n            }\n            cchChkWidth   = w;\n            cchChkHeight  = h;\n            cchChkElement = s;\n        }\n        else {\n            if ( cchChkElement === s ) {\n                if ( cchChkHeight != h || cchChkWidth != w ) {\n                    t.trigger('resize');\n                    cchChkWidth  = w;\n                    cchChkHeight = h;\n                    return true;\n                }\n            }\n        }\n    }\n\n    function taBoxAdj(evt) {\n        var that  = this\n        ,   $ta  = $(that)\n        ,   data  = $ta.data()\n        ,   e  = data._ab_origs\n        ,   style  = that.style\n        ,   ol = $ta.val()\n        ,   v  = ol.split('\\n')\n        ,   ar = $ta.prop('rows')\n        ,   ac = $ta.prop('cols')\n        ,   c  = 0\n        ,   r, i, l\n        ,   options = evt && evt.type && evt.data\n        ;\n\n        chkSize($ta, true);\n\n        for ( i=0,r=v.length; i<r; i++ ) {\n            if ( (l=v[i].length) > c ) {\n                c = l;\n            }\n        }\n\n        // On first call, backup original metric properties\n        if ( !e ) {\n            // Can't init when hidden - all metrics are zero\n            if ( $ta.is(':hidden') ) {\n                return;\n            }\n            $ta.stop(true);\n            e = data._ab_origs = [\n                ar\n              , ac\n              , style.height || $ta.css('height')\n              , style.width  || $ta.css('width')\n              , $ta.css('overflow-y')\n              , $ta.css('overflow-x')\n              , $ta.css('resize')\n            ];\n            e.aw = $ta.attr('width');\n            e.ah = $ta.attr('height');\n            i = 0;\n            if(!e.ah) { i |= RESIZE_VERTICAL_FLAG;   }\n            if(!e.aw) { i |= RESIZE_HORIZONTAL_FLAG; }\n\n            // use ar\n            if( i === 0 || i === (RESIZE_VERTICAL_FLAG | RESIZE_HORIZONTAL_FLAG) ) {\n                // resize option overrides CSS and DOM property\n                switch(options && options.resize || $ta.prop('resize') || $ta.attr('resize') || e[RESIZE_POS]) {\n                    case 'vertical':   i = RESIZE_VERTICAL_FLAG  ; break;\n                    case 'horizontal': i = RESIZE_HORIZONTAL_FLAG; break;\n                }\n            }\n            if ( e.ar = i ) {\n                var css = { resize: 'none' };\n                if(i === RESIZE_VERTICAL_FLAG  ) {\n                    css['overflow-y'] = 'hidden';\n                    !e.aw && (e.aw = e[WIDTH_POS]);\n                    delete e.ah;\n                }\n                if(i === RESIZE_HORIZONTAL_FLAG) {\n                    css['overflow-x'] = 'hidden';\n                    !e.ah && (e.ah = e[HEIGHT_POS]);\n                    delete e.aw;\n                }\n                $ta.css(css);\n            }\n            // Ensure data is saved\n            $ta.data('_ab_origs', e);\n        }\n\n        // Not first call\n        else {\n            e = data._ab_origs;\n            delete e.rest;\n        }\n\n        ol = ol.length;\n        v = e.ah || 'auto';\n        l = e.aw || 'auto';\n        e.nadj = ~e.ar & RESIZE_VERTICAL_FLAG;\n\n        if(!c) {\n            if(r <= 1) {\n                r = e[ROWS_POS];\n                v = e[HEIGHT_POS];\n                e.nadj = true;\n            }\n            else {\n                r++;\n            }\n            c = e[COLS_POS];\n            l = e[WIDTH_POS];\n            (e.ar & RESIZE_VERTICAL_FLAG) && $ta.prop('rows', r);\n        }\n        else {\n            c += 5 + (c>>4);\n            r += ar > 2 || r > 1;\n            (r > ar || ol < e.tl && (e.ar & RESIZE_VERTICAL_FLAG)) && $ta.prop('rows', r);\n        }\n        (e.ar & RESIZE_HORIZONTAL_FLAG) && $ta.prop('cols', c).prop('size', c);\n        $ta.css({'height':taMH(v),'width':l});\n        e.tl = ol;\n\n        function adjRows() {\n            if(!$ta.data('_ab_origs')) return;\n            ar = that.rows;\n            var s = that.scrollHeight\n            ,   h = that.offsetHeight\n            ,   d = 0\n            ,   a = s - h\n            ,   ih = h\n            ,   ir = ar\n            ;\n            for(;d != a && s && h;) {\n                // if(d == a || !s || !h) break;\n                d = a;\n                if(a > 0) {\n                    $ta.prop('rows', Math.max(++ar, (s*ar/h>>0)-1, r));\n                    s = that.scrollHeight;\n                    h = that.offsetHeight;\n                    a = s - h;\n                    // If rows changed but height not, seems there is some limitation on height (ex max-height)\n                    if(ir != that.rows && ih == h) {\n                        $ta.css('overflow-y', '');\n                        $ta.prop('rows', ir);\n                        break;\n                    }\n                }\n            }\n            // if need to adjust height and it changed, try to change it after a delay\n            if(a > 5 && ih != h) setTimeout(adjRows, 16);\n\n            chkSize($ta);\n        }\n\n        e.nadj ? chkSize($ta) : adjRows();\n    }\n\n    function taRestoreBox(e) {\n        var o = $(this)\n        ,   options = e.data\n        ;\n        if(e=o.data('_ab_origs')) {\n            e.rest = true;\n            setTimeout(function () {\n                if(!e.rest) { return; }\n                chkSize(o, true);\n                o.removeData('_ab_origs')\n                 .prop('rows', e[ROWS_POS]) // for textarea\n                 .prop('cols', e[COLS_POS]) // for textarea\n                 .prop('size', e[COLS_POS]) // for input\n                 .css({\n                    'overflow-y': e[OVERFLOW_Y_POS]\n                  , 'overflow-x': e[OVERFLOW_X_POS]\n                  , 'resize'    : e[RESIZE_POS]\n                });\n                e = {\n                    'height': taMH(e[HEIGHT_POS])\n                  , 'width' : e[WIDTH_POS]\n                };\n\n                if(options.speed) {\n                    o.animate(e, options.speed, function () {\n                        chkSize(o);\n                    });\n                }\n                else {\n                    chkSize(o.css(e));\n                }\n            }, options.delay||250); // bigger delay to allow for clicks on element beneath textarea\n        }\n    }\n\n    function autoBox(options) {\n        var o = findTEXTAREA(this) ;\n        if (options) {\n            const evt = { type: 'autobox', data: options };\n            o.each((i, e) => taBoxAdj.call(e, evt));\n        }\n        else {\n            o.each(taBoxAdj);\n        }\n        return this;\n    }\n\n    function autoboxBind(options) {\n        var o = findTEXTAREA(this) ;\n        options = $.extend({}, $.autobox.options, options);\n        o\n         .addClass(AUTOBOXED_CLASS)\n         .off(NAMESPACE);\n        $.each(_events, function (i,e) {\n            o.on(e+NAMESPACE, options, taBoxAdj);\n        });\n        if ( !options.permanent ) {\n            o.on('blur'+NAMESPACE, options, taRestoreBox);\n        }\n        return this;\n    }\n\n    function autoBoxOn(sel, options) {\n        var o = this;\n        options = $.extend({}, $.autobox.options, options);\n        sel || (sel = TEXTAREA);\n        o.off(NAMESPACE, sel)\n         .addClass(AUTOBOXED_CLASS)\n         .on(\n            _events.join(NAMESPACE+' ')+NAMESPACE\n            , sel\n            , options\n            , taBoxAdj\n          )\n        ;\n\n        if ( !options.permanent ) {\n            o.on('blur'+NAMESPACE+' '+'focusout'+NAMESPACE, sel, options, taRestoreBox) ;\n        }\n\n        return o;\n    }\n\n// Export:\n\n    // Collection methods.\n    $.fn.autobox     = autoBox     ;\n    $.fn.autoboxOn   = autoBoxOn   ;\n    $.fn.autoboxBind = autoboxBind ;\n\n    // Alias\n    $.fn.bindAutobox = autoboxBind ;\n\n    // Static method.\n    $.autobox = function(elements, options) {\n      // Override default options with passed-in options.\n      options = $.extend({}, $.autobox.options, options);\n\n      return $(elements).call(autoBox, options);\n    };\n\n    // Static method default options.\n    $.autobox.options = {\n        resize: undefined, // 'vertical' | 'horizontal'\n        permanent: false,\n        speed: 0, // restore height animation speed\n        delay: 250, // delay before restoring textarea height on blur\n    };\n\n    // Custom selector.\n    $.expr[':'].autobox = function(elem) {\n      // Is this element autoboxed?\n      return $(elem).hasClass(AUTOBOXED_CLASS);\n    };\n}\n\nif ( typeof window !== 'undefined' ) {\n    const $ = window.jQuery || window.Zepto;\n    if ( $ ) initJQAutobox($);\n}\n"],"names":["TEXTAREA","AUTOBOXED_CLASS","NAMESPACE","_events","initJQAutobox","$","cchChkElement","cchChkWidth","cchChkHeight","taMH","h","i","parseInt","findTEXTAREA","ctx","filter","add","find","chkSize","s","save","t","w","outerWidth","outerHeight","get","trigger","taBoxAdj","evt","r","l","that","this","$ta","data","e","_ab_origs","style","ol","val","v","split","ar","prop","ac","c","options","type","length","rest","is","stop","height","css","width","aw","attr","ah","resize","nadj","tl","adjRows","rows","scrollHeight","offsetHeight","d","a","ih","ir","Math","max","setTimeout","taRestoreBox","o","removeData","speed","animate","delay","autoBox","each","call","autoboxBind","extend","autobox","addClass","off","on","permanent","fn","autoboxOn","sel","join","bindAutobox","elements","undefined","expr","elem","hasClass","window","jQuery","Zepto"],"mappings":"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"}