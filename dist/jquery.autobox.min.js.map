{"version":3,"file":"jquery.autobox.min.js","sources":["src/jquery.autobox.js"],"sourcesContent":["/**\n * Autogrow Textareas\n * jQuery.autobox\n *\n * https://github.com/duzun/jquery.autobox\n *\n * Copyright (c) 2018 Dumitru Uzun\n *\n *  @license The MIT license.\n *  @version 3.0.2\n *  @author DUzun.Me\n */\n\n/**\n *\n * Usage:\n *\n * $().\n *    autobox()        - Adjust Height/Width of all TEXTAREAs in this and it's descendants\n *    autoboxOn(sel)   - Bind Auto Height/Width Adjustment events to matched element, listening on sel elements\n *    autoboxBind()    - Bind Auto Height/Width Adjustment events to all TEXTAREAs in this and it's descendants\n */\n\n/*jshint\n    esversion: 6,\n    browser: true\n*/\n\nconst TEXTAREA = 'TEXTAREA';\nconst autoboxedClass = 'autoboxed';\nconst namespace = '.dynSiz';\n\nconst _events = [\n        'autobox'\n      , 'keypress'\n      , 'keyup'\n      , 'click'\n      , 'change'\n      , 'focusin'\n      , 'cut'\n      , 'paste'\n    ]\n;\n\n// Constants for internal use\nconst RESIZE_VERTICAL_FLAG   = 1;\nconst RESIZE_HORIZONTAL_FLAG = 2;\n\nconst ROWS_POS       = 0;\nconst COLS_POS       = 1;\nconst HEIGHT_POS     = 2;\nconst WIDTH_POS      = 3;\nconst OVERFLOW_Y_POS = 4;\nconst OVERFLOW_X_POS = 5;\nconst RESIZE_POS     = 6;\n\nexport default function init($) {\n    var cchChkElement;\n    var cchChkWidth;\n    var cchChkHeight;\n\n    function taMH(h,i) {\n        if ( !h || ( (i=parseInt(h, 10)) && i < 18 ) ) {\n            h = '18px';\n        }\n        return h;\n    }\n\n    function findTEXTAREA(ctx) {\n        return ctx.filter(TEXTAREA).add(ctx.find(TEXTAREA));\n    }\n\n    function chkSize(s, save) {\n        var t = $(s)\n        ,   w = t.outerWidth()\n        ,   h = t.outerHeight()\n        ;\n        s = t.get(0);\n        if ( save ) {\n            if ( cchChkElement && cchChkElement !== s ) {\n                chkSize(cchChkElement);\n            }\n            cchChkWidth   = w;\n            cchChkHeight  = h;\n            cchChkElement = s;\n        }\n        else {\n            if ( cchChkElement === s ) {\n                if ( cchChkHeight != h || cchChkWidth != w ) {\n                    t.trigger('resize');\n                    cchChkWidth  = w;\n                    cchChkHeight = h;\n                    return true;\n                }\n            }\n        }\n    }\n\n    function taBoxAdj(evt) {\n        var t  = this\n        ,   o  = $(t)\n        ,   d  = o.data()\n        ,   e  = d._ab_origs\n        ,   s  = t.style\n        ,   ol = o.val()\n        ,   v  = ol.split('\\n')\n        ,   ar = o.prop('rows')\n        ,   ac = o.prop('cols')\n        ,   c  = 0\n        ,   r, i, l\n        ,   opt = evt && evt.type && evt.data\n        ;\n\n        chkSize(o, true);\n\n        for ( i=0,r=v.length; i<r; i++ ) {\n            if ( (l=v[i].length) > c ) {\n                c = l;\n            }\n        }\n\n        // On first call, backup original metric properties\n        if ( !e ) {\n            // Can't init when hidden - all metrics are zero\n            if ( o.is(':hidden') ) {\n                return;\n            }\n            o.stop(true);\n            e = d._ab_origs = [\n                ar\n              , ac\n              , s.height || o.css('height')\n              , s.width  || o.css('width')\n              , o.css('overflow-y')\n              , o.css('overflow-x')\n              , o.css('resize')\n            ];\n            e.aw = o.attr('width');\n            e.ah = o.attr('height');\n            i = 0;\n            if(!e.ah) { i |= RESIZE_VERTICAL_FLAG;   }\n            if(!e.aw) { i |= RESIZE_HORIZONTAL_FLAG; }\n\n            // use ar\n            if( i === 0 || i === (RESIZE_VERTICAL_FLAG | RESIZE_HORIZONTAL_FLAG) ) {\n                // resize option overrides CSS and DOM property\n                switch(opt && opt.resize || o.prop('resize') || o.attr('resize') || e[RESIZE_POS]) {\n                    case 'vertical':   i = RESIZE_VERTICAL_FLAG  ; break;\n                    case 'horizontal': i = RESIZE_HORIZONTAL_FLAG; break;\n                }\n            }\n            if ( e.ar = i ) {\n                var css = { resize: 'none' };\n                if(i === RESIZE_VERTICAL_FLAG  ) {\n                    css['overflow-y'] = 'hidden';\n                    !e.aw && (e.aw = e[WIDTH_POS]);\n                    delete e.ah;\n                }\n                if(i === RESIZE_HORIZONTAL_FLAG) {\n                    css['overflow-x'] = 'hidden';\n                    !e.ah && (e.ah = e[HEIGHT_POS]);\n                    delete e.aw;\n                }\n                o.css(css);\n            }\n            // Ensure data is saved\n            o.data('_ab_origs', e);\n        }\n\n        // Not first call\n        else {\n            e = d._ab_origs;\n            delete e.rest;\n        }\n\n        ol = ol.length;\n        v = e.ah || 'auto';\n        l = e.aw || 'auto';\n        e.nadj = ~e.ar & RESIZE_VERTICAL_FLAG;\n\n        if(!c) {\n            if(r <= 1) {\n                r = e[ROWS_POS];\n                v = e[HEIGHT_POS];\n                e.nadj = true;\n            }\n            else {\n                r++;\n            }\n            c = e[COLS_POS];\n            l = e[WIDTH_POS];\n            (e.ar & RESIZE_VERTICAL_FLAG) && o.prop('rows', r);\n        }\n        else {\n            c += 5 + (c>>4);\n            r += ar > 2 || r > 1;\n            (r > ar || ol < e.tl && (e.ar & RESIZE_VERTICAL_FLAG)) && o.prop('rows', r);\n        }\n        (e.ar & RESIZE_HORIZONTAL_FLAG) && o.prop('cols', c).prop('size', c);\n        o.css({'height':taMH(v),'width':l});\n        e.tl = ol;\n\n        function adjRows() {\n            if(!o.data('_ab_origs')) return;\n            ar = t.rows;\n            var s = t.scrollHeight\n            ,   h = t.offsetHeight\n            ,   d = 0\n            ,   a = s - h\n            ,   ih = h\n            ,   ir = ar\n            ;\n            for(;d != a && s && h;) {\n                // if(d == a || !s || !h) break;\n                d = a;\n                if(a > 0) {\n                    o.prop('rows', Math.max(++ar, (s*ar/h>>0)-1, r));\n                    s = t.scrollHeight;\n                    h = t.offsetHeight;\n                    a = s - h;\n                    // If rows changed but height not, seems there is some limitation on height (ex max-height)\n                    if(ir != t.rows && ih == h) {\n                        o.css('overflow-y', '');\n                        o.prop('rows', ir);\n                        break;\n                    }\n                }\n            }\n            // if need to adjust height and it changed, try to change it after a delay\n            if(a > 5 && ih != h) setTimeout(adjRows, 16);\n\n            chkSize(o);\n        }\n\n        e.nadj ? chkSize(o) : adjRows();\n    }\n\n    function taRestoreBox(e) {\n        var o = $(this)\n        ,   d = e.data\n        ;\n        if(e=o.data('_ab_origs')) {\n            e.rest = true;\n            setTimeout(function () {\n                if(!e.rest) { return; }\n                chkSize(o, true);\n                o.removeData('_ab_origs')\n                 .prop('rows', e[ROWS_POS]) // for textarea\n                 .prop('cols', e[COLS_POS]) // for textarea\n                 .prop('size', e[COLS_POS]) // for input\n                 .css({\n                    'overflow-y': e[OVERFLOW_Y_POS]\n                  , 'overflow-x': e[OVERFLOW_X_POS]\n                  , 'resize'    : e[RESIZE_POS]\n                });\n                e = {\n                    'height': taMH(e[HEIGHT_POS])\n                  , 'width' : e[WIDTH_POS]\n                };\n\n                if(d.speed) {\n                    o.animate(e, d.speed, function () {\n                        chkSize(o);\n                    });\n                }\n                else {\n                    chkSize(o.css(e));\n                }\n            }, d.delay||250); // bigger delay to allow for clicks on element beneath textarea\n        }\n    }\n\n    function autoBox() {\n        var o = findTEXTAREA(this) ;\n        o.each(taBoxAdj);\n        return this;\n    }\n\n    function autoboxBind(opt) {\n        var o = findTEXTAREA(this) ;\n        opt = $.extend({}, $.autobox.options, opt);\n        o\n         .addClass(autoboxedClass)\n         .off(namespace);\n        $.each(_events, function (i,e) {\n            o.on(e+namespace, opt, taBoxAdj);\n        });\n        if ( !opt.permanent ) {\n            o.on('blur'+namespace, opt, taRestoreBox);\n        }\n        return this;\n    }\n\n    function autoBoxOn(sel, opt) {\n        var o = this;\n        opt = $.extend({}, $.autobox.options, opt);\n        sel || (sel = TEXTAREA);\n        o.off(namespace, sel)\n         .addClass(autoboxedClass)\n         .on(\n            _events.join(namespace+' ')+namespace\n            , sel\n            , opt\n            , taBoxAdj\n          )\n        ;\n\n        if ( !opt.permanent ) {\n            o.on('blur'+namespace+' '+'focusout'+namespace, sel, opt, taRestoreBox) ;\n        }\n\n        return o;\n    }\n\n// Export:\n\n    // Collection methods.\n    $.fn.autobox     = autoBox     ;\n    $.fn.autoboxOn   = autoBoxOn   ;\n    $.fn.autoboxBind = autoboxBind ;\n\n    // Alias\n    $.fn.bindAutobox = autoboxBind ;\n\n    // Static method.\n    $.autobox = function(elements, options) {\n      // Override default options with passed-in options.\n      options = $.extend({}, $.autobox.options, options);\n      // Return something awesome.\n      return $(elements).call(autoBox);\n    };\n\n    // Static method default options.\n    $.autobox.options = {\n      resize: undefined, // 'vertical' | 'horizontal'\n      permanent: false\n    };\n\n    // Custom selector.\n    $.expr[':'].autobox = function(elem) {\n      // Is this element awesome?\n      return $(elem).hasClass(autoboxedClass);\n    };\n}\n\nif ( typeof window !== 'undefined' ) {\n    const $ = window.jQuery || window.Zepto;\n    if ( $ ) init($);\n}\n"],"names":["TEXTAREA","autoboxedClass","namespace","_events","RESIZE_VERTICAL_FLAG","RESIZE_HORIZONTAL_FLAG","ROWS_POS","COLS_POS","HEIGHT_POS","WIDTH_POS","OVERFLOW_Y_POS","OVERFLOW_X_POS","RESIZE_POS","init","$","cchChkElement","cchChkWidth","cchChkHeight","taMH","h","i","parseInt","findTEXTAREA","ctx","filter","add","find","chkSize","s","save","t","w","outerWidth","outerHeight","get","trigger","taBoxAdj","evt","r","l","this","o","d","data","e","_ab_origs","style","ol","val","v","split","ar","prop","ac","c","opt","type","length","rest","is","stop","height","css","width","aw","attr","ah","resize","nadj","tl","adjRows","rows","scrollHeight","offsetHeight","a","ih","ir","Math","max","setTimeout","taRestoreBox","removeData","speed","animate","delay","autoBox","each","autoboxBind","extend","autobox","options","addClass","off","on","permanent","fn","autoboxOn","sel","join","bindAutobox","elements","call","undefined","expr","elem","hasClass","window","jQuery","Zepto"],"mappings":"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"}